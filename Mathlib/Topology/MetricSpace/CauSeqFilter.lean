import VerifiedAgora.tagger
/-
Copyright (c) 2018 Robert Y. Lewis. All rights reserved.
Released under Apache 2.0 license as described in the file LICENSE.
Authors: Robert Y. Lewis, S√©bastien Gou√´zel
-/
import Mathlib.Analysis.Normed.Field.Basic
import Mathlib.Topology.MetricSpace.Cauchy

/-!
# Completeness in terms of `Cauchy` filters vs `isCauSeq` sequences

In this file we apply `Metric.complete_of_cauchySeq_tendsto` to prove that a `NormedRing`
is complete in terms of `Cauchy` filter if and only if it is complete in terms
of `CauSeq` Cauchy sequences.
-/

universe u v

open Set Filter Topology

variable {Œ≤ : Type v}

@[target] theorem CauSeq.tendsto_limit [NormedRing Œ≤] [hn : IsAbsoluteValue (norm : Œ≤ ‚Üí ‚Ñù)]
    (f : CauSeq Œ≤ norm) [CauSeq.IsComplete Œ≤ norm] : Tendsto f atTop (ùìù f.lim) := by sorry


variable [NormedField Œ≤]

/-
 This section shows that if we have a uniform space generated by an absolute value, topological
 completeness and Cauchy sequence completeness coincide. The problem is that there isn't
 a good notion of "uniform space generated by an absolute value", so right now this is
 specific to norm. Furthermore, norm only instantiates IsAbsoluteValue on NormedDivisionRing.
 This needs to be fixed, since it prevents showing that ‚Ñ§_[hp] is complete.
-/
open Metric

@[target] theorem CauchySeq.isCauSeq {f : ‚Ñï ‚Üí Œ≤} (hf : CauchySeq f) : IsCauSeq norm f := by sorry


theorem CauSeq.cauchySeq (f : CauSeq Œ≤ norm) : CauchySeq f := by
  refine cauchy_iff.2 ‚ü®by infer_instance, fun s hs => ?_‚ü©
  rcases mem_uniformity_dist.1 hs with ‚ü®Œµ, ‚ü®hŒµ, hŒµs‚ü©‚ü©
  obtain ‚ü®N, hN‚ü© := CauSeq.cauchy‚ÇÇ f hŒµ
  exists { n | n ‚â• N }.image f
  simp only [exists_prop, mem_atTop_sets, mem_map, mem_image, mem_setOf_eq]
  constructor
  ¬∑ exists N
    intro b hb
    exists b
  ¬∑ rintro ‚ü®a, b‚ü© ‚ü®‚ü®a', ‚ü®ha'1, ha'2‚ü©‚ü©, ‚ü®b', ‚ü®hb'1, hb'2‚ü©‚ü©‚ü©
    dsimp at ha'1 ha'2 hb'1 hb'2
    rw [‚Üê ha'2, ‚Üê hb'2]
    apply hŒµs
    rw [dist_eq_norm]
    apply hN <;> assumption

/-- In a normed field, `CauSeq` coincides with the usual notion of Cauchy sequences. -/
theorem isCauSeq_iff_cauchySeq {Œ± : Type u} [NormedField Œ±] {u : ‚Ñï ‚Üí Œ±} :
    IsCauSeq norm u ‚Üî CauchySeq u :=
  ‚ü®fun h => CauSeq.cauchySeq ‚ü®u, h‚ü©, fun h => h.isCauSeq‚ü©

-- see Note [lower instance priority]
/-- A complete normed field is complete as a metric space, as Cauchy sequences converge by
assumption and this suffices to characterize completeness. -/
instance (priority := 100) completeSpace_of_cauSeq_isComplete [CauSeq.IsComplete Œ≤ norm] :
    CompleteSpace Œ≤ := by
  apply complete_of_cauchySeq_tendsto
  intro u hu
  have C : IsCauSeq norm u := isCauSeq_iff_cauchySeq.2 hu
  exists CauSeq.lim ‚ü®u, C‚ü©
  rw [Metric.tendsto_atTop]
  intro Œµ Œµpos
  obtain ‚ü®N, hN‚ü© := (CauSeq.equiv_lim ‚ü®u, C‚ü©) _ Œµpos
  exists N
  simpa [dist_eq_norm] using hN
